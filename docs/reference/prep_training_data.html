<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Align training data and apply a method of elastic fPCA — prep_training_data • veesa</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Align training data and apply a method of elastic fPCA — prep_training_data"><meta name="description" content="Applies steps 2 and 3 of the VEESA pipeline (alignment and elastic fPCA) to the training data
    in preparation for inputting the data to the model in step 4."><meta property="og:description" content="Applies steps 2 and 3 of the VEESA pipeline (alignment and elastic fPCA) to the training data
    in preparation for inputting the data to the model in step 4."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">veesa</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.7</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Align training data and apply a method of elastic fPCA</h1>

      <div class="d-none name"><code>prep_training_data.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Applies steps 2 and 3 of the VEESA pipeline (alignment and elastic fPCA) to the training data
    in preparation for inputting the data to the model in step 4.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">prep_training_data</span><span class="op">(</span></span>
<span>  <span class="va">f</span>,</span>
<span>  <span class="va">time</span>,</span>
<span>  <span class="va">fpca_method</span>,</span>
<span>  lambda <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  penalty_method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"roughness"</span>, <span class="st">"geodesic"</span>, <span class="st">"norm"</span><span class="op">)</span>,</span>
<span>  centroid_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mean"</span>, <span class="st">"median"</span><span class="op">)</span>,</span>
<span>  center_warpings <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  parallel <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  cores <span class="op">=</span> <span class="op">-</span><span class="fl">1</span>,</span>
<span>  optim_method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"DP"</span>, <span class="st">"DPo"</span>, <span class="st">"DP2"</span>, <span class="st">"RBFGS"</span><span class="op">)</span>,</span>
<span>  max_iter <span class="op">=</span> <span class="fl">20L</span>,</span>
<span>  id <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  C <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  ci <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2</span>, <span class="op">-</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-f">f<a class="anchor" aria-label="anchor" href="#arg-f"></a></dt>
<dd><p>Matrix (size M x N) of training data with N functions and M samples.</p></dd>


<dt id="arg-time">time<a class="anchor" aria-label="anchor" href="#arg-time"></a></dt>
<dd><p>Vector of size M corresponding to the M sample points.</p></dd>


<dt id="arg-fpca-method">fpca_method<a class="anchor" aria-label="anchor" href="#arg-fpca-method"></a></dt>
<dd><p>Character string specifying the type of elastic fPCA
method to use. Options are 'jfpca', 'hfpca', or 'vfpca'.</p></dd>


<dt id="arg-lambda">lambda<a class="anchor" aria-label="anchor" href="#arg-lambda"></a></dt>
<dd><p>Numeric value specifying the elasticity. Default is 0.</p></dd>


<dt id="arg-penalty-method">penalty_method<a class="anchor" aria-label="anchor" href="#arg-penalty-method"></a></dt>
<dd><p>String specifying the penalty term used in the
formulation of the cost function to minimize for alignment. Choices
are "roughness" which uses the norm of the second derivative,
"geodesic" which uses the geodesic distance to the identity and
"norm" which uses the Euclidean distance to the identity. Defaults
is "roughness".</p></dd>


<dt id="arg-centroid-type">centroid_type<a class="anchor" aria-label="anchor" href="#arg-centroid-type"></a></dt>
<dd><p>String specifying the type of centroid to align to.
Options are "mean" or "median". Defaults is "mean".</p></dd>


<dt id="arg-center-warpings">center_warpings<a class="anchor" aria-label="anchor" href="#arg-center-warpings"></a></dt>
<dd><p>Boolean specifying whether to center the estimated
warping functions. Defaults is TRUE.</p></dd>


<dt id="arg-parallel">parallel<a class="anchor" aria-label="anchor" href="#arg-parallel"></a></dt>
<dd><p>Boolean specifying whether to run calculations in parallel.
Defaults is FALSE.</p></dd>


<dt id="arg-cores">cores<a class="anchor" aria-label="anchor" href="#arg-cores"></a></dt>
<dd><p>Integer specifying the number of cores in parallel. Default is
-1, which uses all cores.</p></dd>


<dt id="arg-optim-method">optim_method<a class="anchor" aria-label="anchor" href="#arg-optim-method"></a></dt>
<dd><p>Method used for optimization when computing the Karcher
mean. Options are "DP", "DPo", and "RBFGS".</p></dd>


<dt id="arg-max-iter">max_iter<a class="anchor" aria-label="anchor" href="#arg-max-iter"></a></dt>
<dd><p>An integer value specifying the maximum number of iterations.
Defaults to 20L.</p></dd>


<dt id="arg-id">id<a class="anchor" aria-label="anchor" href="#arg-id"></a></dt>
<dd><p>Integration point for f0. Default is midpoint.</p></dd>


<dt id="arg-c">C<a class="anchor" aria-label="anchor" href="#arg-c"></a></dt>
<dd><p>Balance value. Default = NULL.</p></dd>


<dt id="arg-ci">ci<a class="anchor" aria-label="anchor" href="#arg-ci"></a></dt>
<dd><p>Geodesic standard deviations to be computed. Default is
c(-2, -1, 0, 1, 2).</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>List with three objects:</p><ul><li><p>alignment: output from fdasrvf::time_warping</p></li>
<li><p>fpca_type: type of elastic FPCA method applied</p></li>
<li><p>fpca_res: output from fdasrvf::jointFPCA, fdasrvf::horizFPCA, or
        fdasrvf::vertFPCA (dependent on fpca_type)</p></li>
</ul></div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># Load packages</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Select a subset of functions from shifted peaks data</span></span></span>
<span class="r-in"><span><span class="va">sub_ids</span> <span class="op">&lt;-</span></span></span>
<span class="r-in"><span>  <span class="va">shifted_peaks</span><span class="op">$</span><span class="va">data</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">data</span>, <span class="va">group</span>, <span class="va">id</span><span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">data</span>, <span class="va">group</span><span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Create a smaller version of shifted data</span></span></span>
<span class="r-in"><span><span class="va">shifted_peaks_sub</span> <span class="op">&lt;-</span></span></span>
<span class="r-in"><span>  <span class="va">shifted_peaks</span><span class="op">$</span><span class="va">data</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">sub_ids</span><span class="op">$</span><span class="va">id</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Extract times</span></span></span>
<span class="r-in"><span><span class="va">shifted_peaks_times</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">shifted_peaks_sub</span><span class="op">$</span><span class="va">t</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Convert training data to matrix</span></span></span>
<span class="r-in"><span><span class="va">shifted_peaks_train_matrix</span> <span class="op">&lt;-</span></span></span>
<span class="r-in"><span>  <span class="va">shifted_peaks_sub</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">data</span> <span class="op">==</span> <span class="st">"Training"</span><span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">t</span><span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>index <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"t"</span>, <span class="va">index</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider</a></span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">index</span>, values_from <span class="op">=</span> <span class="va">y</span><span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">data</span>, <span class="op">-</span><span class="va">id</span>, <span class="op">-</span><span class="va">group</span><span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Obtain veesa pipeline training data</span></span></span>
<span class="r-in"><span><span class="va">veesa_train</span> <span class="op">&lt;-</span></span></span>
<span class="r-in"><span>  <span class="fu">prep_training_data</span><span class="op">(</span></span></span>
<span class="r-in"><span>    f <span class="op">=</span> <span class="va">shifted_peaks_train_matrix</span>,</span></span>
<span class="r-in"><span>    time <span class="op">=</span> <span class="va">shifted_peaks_times</span>,</span></span>
<span class="r-in"><span>    fpca_method <span class="op">=</span> <span class="st">"jfpca"</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> Using lambda = 0</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> Initializing...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> Computing Karcher mean of 8 functions in SRSF space...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> Entering iteration 1...</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Katherine Goode, J. Derek Tucker, Sandia National Laboratories.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

